<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/password.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Login</title>
</head>
<body>
    <div class="background">
        <img src="static/bubblepass.png" alt="background" />
    </div>
    <div class="title-container">
        <div class="logo">
            <img src="static/profile.png" alt="profile" />
        </div>
        <div class="header">
            <h1>Hello, USER!</h1>
            <p>Type your password</p>
            <form action="/submit" method="POST">
                <div id="otp-container" class="otp-container">
                    <input type="text" maxlength="1" />
                    <input type="text" maxlength="1" />
                    <input type="text" maxlength="1" />
                    <input type="text" maxlength="1" />
                </div>
                
                <!-- Round password (hidden initially) -->
                <div id="circle-password" class="circle-container hidden">
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <!-- Hidden but visible password field -->
                    <input type="password" id="hidden-password" name="password" class="hidden-input" maxlength="8" autocomplete="off">
                </div>
                
                <br><br>
                <div class="button">
                    <button type="button" class="reject-btn" onclick="window.location.href='/login'">Not you?<i class="fas fa-arrow-right"></i></button>
                </div>
            </form>
        </div>
    </div>
    

    <script>
        const otpInputs = document.querySelectorAll('#otp-container input');
        const otpContainer = document.getElementById('otp-container');
        const circleContainer = document.getElementById('circle-password');
        const hiddenPassword = document.getElementById('hidden-password');
        const circles = document.querySelectorAll('.circle');
      
        otpInputs.forEach((input, idx) => {
          input.addEventListener('input', () => {
            // Move to the next input field after typing
            if (input.value.length > 0 && idx < otpInputs.length - 1) {
              otpInputs[idx + 1].focus();
            }
      
            // When all OTP inputs are filled, switch to the circle password style
            const value = Array.from(otpInputs).map(i => i.value).join('');
            if (value.length === otpInputs.length) {
              otpContainer.classList.add('hidden');  // Hide OTP input fields
              circleContainer.classList.remove('hidden');  // Show circle password style
              hiddenPassword.value = value;  // Set the hidden password input value
              hiddenPassword.focus();  // Focus on the hidden password field
              updateCircles(value);  // Update circles based on OTP input value
            }
          });
          
          // Allow backspace to move to previous field
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && input.value.length === 0 && idx > 0) {
              otpInputs[idx - 1].focus();
            }
          });
        });
      
        // Handle input in the hidden password field (round password style)
        hiddenPassword.addEventListener('input', () => {
          const value = hiddenPassword.value;
          updateCircles(value);
          
          // Auto-submit when 8 digits are entered
          if (value.length === 8) {
            document.querySelector('form').submit();
          }
        });
      
        // Update the circles based on the current input value
        function updateCircles(value) {
          circles.forEach((circle, idx) => {
            if (idx < value.length) {
              circle.classList.add('filled');
            } else {
              circle.classList.remove('filled');
            }
          });
        }

        // Focus on first OTP input when page loads
        otpInputs[0].focus();
    </script>
</body>
</html>